<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=0.8, user-scalable=0"/>
    <meta name="mobile-web-app-capable" content="yes"> <!-- TODO: Use new scheme for homescreen adding -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/ripples.min.css" rel="stylesheet">
    <link href="css/material-wfont.min.css" rel="stylesheet">

    <style>
        html, body {
            max-width: 100%;
            overflow-x: hidden;
        }
        .menu ul {
            list-style-type: none;
            padding: 0;
        }
        .menu li {
            padding: 1em;
            cursor: hand;
        }
        .menu li.active  {
            background-color: #03a9f4;
            color: white;
        }
        .pages {
            top:0;
            left:0;
            height: 35.1em;
            z-index: 1;
        }
        .page {
            overflow: auto;
            position: absolute;
            width: 98%;
            height: 33.7em;
            padding-bottom: 1em;
            -webkit-transform: translateX(300%);
            -moz-transform: translateX(300%);
            transform: translateX(300%);
            -webkit-transition: transform .6s ease-in;
            -moz-transition: transform .6s ease-in;
            transition: transform .6s ease-in;
            z-index: 1;
        }
        .page.active {
            -webkit-transform: translateX(0);
            -moz-transform: translateX(0);
            transform: translateX(0);
            -webkit-transition: transform .6s ease-out;
            -moz-transition: transform .6s ease-out;
            transition: transform .6s ease-out;
        }
        .notes {
            font-size: 24px;
        }
        .timer-block {
            height: 10.5em;
        }
        #timerHeader {
            margin-top: 0;
            position: absolute;
            -webkit-transform: translateX(0);
            -moz-transform: translateX(0);
            transform: translateX(0);
        }
        #timerHeader.active {
            -webkit-transform: translateX(400%);
            -moz-transform: translateX(400%);
            transform: translateX(400%);
            -webkit-transition: transform .8s ease-in;
            -moz-transition: transform .8s ease-in;
            transition: transform .8s ease-in;
        }
        h1 {
            margin-top: 0;
        }
    </style>

</head>

<body>
    <!-- Your site -->
    <br />
    <div class="container">
        <div class="row">
        <div class="well">
            <h1 style="margin-top: 0.3em">Web Planner and Scheduler</h1>
        </div>
        </div>
        <div class="row">
            <div class="menu col-sm-4 well">
                <ul>
                    <li class="active withripple" data-target="#class1">Class 1</li>
                    <li class="withripple" data-target="#class2">Class 2</li>
                    <li class="withripple" data-target="#class3">Class 3</li>
                    <li class="withripple" data-target="#class4">Class 4</li>
                    <li class="withripple" data-target="#class5">Class 5</li>
                    <li class="withripple" data-target="#class6">Class 6</li>
                    <li class="withripple" data-target="#class7">Class 7</li>
                    <li class="withripple" data-target="#class8">Class 8</li>
                </ul>
            </div>
                <div class="pages col-sm-8">
                    <div class="well page active" id="class1">
                        <h1>Class 1</h1>
                        <textarea class="form-control floating-label notes" placeholder="Homework" rows="5"></textarea>
                    </div>
                    <div class="well page" id="class2" style="display: none;">
                        <h1>Class 2</h1>
                        <textarea class="form-control floating-label notes" placeholder="Homework" rows="5"></textarea>
                    </div>
                    <div class="well page" id="class3" style="display: none;">
                        <h1>Class 3</h1>
                        <textarea class="form-control floating-label notes" placeholder="Homework" rows="5"></textarea>
                    </div>
                    <div class="well page" id="class4" style="display: none;">
                        <h1>Class 4</h1>
                        <textarea class="form-control floating-label notes" placeholder="Homework" rows="5"></textarea>
                    </div>
                    <div class="well page" id="class5" style="display: none;">
                        <h1>Class 5</h1>
                        <textarea class="form-control floating-label notes" placeholder="Homework" rows="5"></textarea>
                    </div>
                    <div class="well page" id="class6" style="display: none;">
                        <h1>Class 6</h1>
                        <textarea class="form-control floating-label notes" placeholder="Homework" rows="5"></textarea>
                    </div>
                    <div class="well page" id="class7" style="display: none;">
                        <h1>Class 6</h1>
                        <textarea class="form-control floating-label notes" placeholder="Homework" rows="5"></textarea>
                    </div>
                    <div class="well page" id="class8" style="display: none;">
                        <h1>Class 6</h1>
                        <textarea class="form-control floating-label notes" placeholder="Homework" rows="5"></textarea>
                    </div>
                </div>
        </div>
        <div class="row well timer-block well-success">
            <h1 id="timerHeader"></h1>
            <div style="margin-top: 3em;">
                <span id="currentTime">0:00</span>
                <div class="progress progress-striped active" style="margin-top: .5em;">
                    <div class="progress-bar progress-bar-material-blue" id="classProgress" style="width: 0%"></div>
                </div>
            </div>
            <table style="width:100%;">
                <tr>
                    <td id="startTime">0:00</td>
                    <td class="text-right" id="endTime">0:00</td>
                </tr>
            </table>
        </div>
    </div>



    <!-- Your site ends -->

    <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

    <script src="js/ripples.min.js"></script>
    <script src="js/material.min.js"></script>
    <script>

        function t(h,m) {
            return (h*60+m)*60;
        }

        schedule = [
            {
                name: 'Programming',
                timeStart: t(7,30),
                timeEnd: t(8,20)
            },
            {
                name: 'Algebra 2A',
                timeStart: t(8,25),
                timeEnd: t(9,45)
            },
            {
                name: "Chemistry A",
                timeStart: t(9,50),
                timeEnd: t(10,40)
            },
            {
                name: "English 2A (1)",
                timeStart: t(10,45),
                timeEnd: t(11,15)
            },
            {
                name: "Lunch 2",
                timeStart: t(11,20),
                timeEnd: t(11,50)
            },
            {
                name: "English 2A (3)",
                timeStart: t(11,55),
                timeEnd: t(12,25)
            },
            {
                name: "Free",
                timeStart: t(12,30),
                timeEnd: t(13,15)
            },
            {
                name: "US History A",
                timeStart: t(13,20),
                timeEnd: t(14,15)
            }
        ];
        $(document).ready(function() {
            $.material.init();
            var i = 0;
            $('.page').each(function() {
                var cls = schedule[i];
                $(this).find('h1').first().text(cls.name);
                i++;
            });
            i = 0;
            $('.menu li').each(function(){
                var cls = schedule[i];
                $(this).text(cls.name);
                i++;
            });

            var classHeaderTO = setTimeout(function() {
                        if(currentClass!=null) $("#timerHeader").text(currentClass.name)
                    },
                    40);
            var progressLoop = setInterval(function(){
                var now = new Date(),
                then = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0);
                var secsSinceMidnight = (now.getTime() - then.getTime())/1000;

                for(var classId = 0; classId < schedule.length; classId++) {
                    if(schedule[classId].timeStart < secsSinceMidnight && secsSinceMidnight < schedule[classId].timeEnd) {
                        currentClass = schedule[classId];
                        break;
                    }
                    if(schedule[classId].timeEnd < secsSinceMidnight && secsSinceMidnight < schedule[classId+1].timeStart) {
                        currentClass = {
                            name: "Passing Time",
                            timeStart: schedule[classId].timeEnd,
                            timeEnd: schedule[classId+1].timeStart
                        };
                        break;
                    }

                }
                if(currentClass != null) {
                    $(".menu li").each(function() {
                        if($(this).data('target') != '#class'+(classId+1) ||
                                $(this).hasClass('active') ||
                                currentClass.name == "Passing Time") { $(this).removeClass('btn-success'); return; }

                        $(this).addClass('btn-success');
                    });


                    percentComplete = Math.round((secsSinceMidnight - currentClass.timeStart)/(currentClass.timeEnd - currentClass.timeStart)*10000)/100;


                    var timeThroughCurrentClass = secsSinceMidnight-currentClass.timeStart;
                    var totalMins = Math.floor(timeThroughCurrentClass/60);
                    var min = totalMins == 0 ? "00" : ((totalMins < 10) ? "0" + totalMins : totalMins);
                    var sec = Math.floor(timeThroughCurrentClass%60);
                    sec = sec == 0 ? "00" : ((sec < 10) ? "0" + sec : sec);

                    $("#currentTime").text( min+ ":" + sec).css("margin-left", percentComplete-1.5 + "%");

                    var hours = Math.floor(currentClass.timeStart/60/60);
                    totalMins = Math.floor(currentClass.timeStart/60);
                    min = totalMins == 0 ? "00" : ((totalMins%60 < 10) ? "0" + totalMins%60 : totalMins%60);
                    $("#startTime").text((hours > 12 ? hours-12 : hours) + ":" + min + (hours >= 12 ? " PM" : " AM"));

                    hours = Math.floor(currentClass.timeEnd/60/60);
                    totalMins = Math.floor(currentClass.timeEnd/60);
                    min = totalMins == 0 ? "00" : ((totalMins%60 < 10) ? "0" + totalMins%60 : totalMins%60);
                    $("#endTime").text( (hours > 12 ? hours-12 : hours) + ":" + min + (hours >= 12 ? " PM" : " AM"));

                    if(percentComplete>99.95) {
                        clearTimeout(classHeaderTO);
                        classHeaderTO = setTimeout(function() {
                            $("#timerHeader").addClass("active").fadeOut(800,function() {
                                $("#timerHeader").text(currentClass.name);
                                $(this).removeClass("active");
                                setTimeout(function(){$(this).fadeIn(800);}.bind(this),100);
                            });
                        }, 700);
                    }
                }
            }, 20);
            setInterval(function(){$("#classProgress").css("width", percentComplete + "%")}, 50);

        });



        $(".menu li").click(function() {

            if($(this).is('.active')) return;
            $(".menu li").removeClass("active");
            $(this).addClass("active");

            var target = $($(this).data('target'));

            var oldPage = $('.page.active');
            oldPage.removeClass('active');
            oldPage.fadeOut(400);

            setTimeout(function() {
                target.fadeIn();
                target.addClass('active');
            }, 400);

        });
    </script>
</body>

</html>
